<h3 class="text-left">New Service</h3>
<% if @error %>
  <%= @error["status"] %>
<% end %>
<form method="post" id="new-app">
  <p><input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>" ></p>
  <div class="row">
    <div class="md-form">
    </div>
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-8">
          <div class="form-grou md-form">
            <label for="service-name"><strong>Name (no space)</strong></label>
            <input type="text" class="form-control" id="service-name" name="service_name" required pattern="^\S+$">
          </div>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-md-6">
          <strong>Default Configuration</strong>
        </div>
      </div>
      <br>
      <%= render :partial => "configurations/configuration_editor", locals:{:configuration => `{"test": "123"}`} %>
      </div>
      <div class="d-flex col-12 justify-content-center">
          <div class="form-group col-md-4 ml-auto mr-auto">
            <button class="btn btn-success btn-sm" id="save-config-button">Save</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</form>
<script>
  // $(document).ready(function(){
  //   var index = 2;
  //   $("#add-more").click(function(e) {
  //     $("#key-value-data").append(`
  //       <div id="keyform-${index}" class="col-md-4">
  //         <div class="form-group">
  //           <input type="text" id="key-${index}" class="form-control key" name="key" placeholder="New key...">
  //         </div>
  //       </div>
  //       <div id="valueform-${index}" class="col-md-4">
  //         <div class="form-group">
  //           <input type="text" id="value-${index}" class="form-control value" name="value" placeholder="New value...">
  //         </div>
  //       </div>
  //       <div id="removeform-${index}" class="col-md-2">
  //         <div class="form-group">
  //           <button id="remove-${index}" class="btn btn-sm btn-danger remove-key"> X </button>
  //         </div>
  //       </div>
  //     `)
  //     index = index+1
  //
  //     $(".remove-key").click(function(e) {
  //       var fieldNum = this.id.charAt(this.id.length-1)
  //       $(this).remove()
  //       $(`#removeform-${fieldNum}`).remove()
  //       $(`#keyform-${fieldNum}`).remove()
  //       $(`#valueform-${fieldNum}`).remove()
  //     })
  //   });
  //
  //   $("#save-config-button").click(function(e) {
  //     let keys = document.querySelectorAll('.key')
  //     let values = document.querySelectorAll('.value')
  //     let arrKeys = parseNodeList(keys)
  //     let arrValues = parseNodeList(values)
  //     let jsonConfigs = {}
  //
  //     for (let i = 0; i < arrKeys.length; i++) {
  //       jsonConfigs[arrKeys[i]] = arrValues[i]
  //     }
  //
  //     axios({
  //       method: 'post',
  //       url: '/service/new',
  //       data: {
  //         name: $("#service-name").val()
  //       },
  //       headers: {
  //         'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content'),
  //         'Content-Type': 'application/json'
  //       }
  //     }).then(() => {
  //       axios({
  //         method: 'post',
  //         url: '/namespace/new',
  //         data: {
  //           servicename: $("#service-name").val(),
  //           namespace: "default",
  //           configurations: jsonConfigs
  //         },
  //         headers: {
  //           'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content'),
  //           'Content-Type': 'application/json'
  //         }
  //       }).then(() => {
  //         window.location.replace(`http://localhost:3000/namespace/${$("#service-name").val()}`);
  //       }).catch((err) => {
  //         console.log(err)
  //       })
  //     }).catch((err) => {
  //       console.log(err)
  //     })
  //   })
  //
  //   function parseNodeList(nodeName) {
  //     let arrReturn = []
  //     nodeName.forEach.call(nodeName, function(node) {
  //       arrReturn.push(node.value)
  //     })
  //     return arrReturn
  //   }
  // });
</script>
